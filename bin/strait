#!/usr/bin/env node

var Commander = require("commander");

Commander
  .usage("[options] [source_addr:]source_port target_addr:target_port")
  .option("-D, --daemon             ",     "")
  .option("-l, --log          <FILE>",     "records log to FILE", process.stdout)
  .option("-c, --cert         <CERT>",     "certificate/key to use", null)
  .option("-t, --timeout      <TIMEOUT>",  "server exits after TIMEOUT when no client connected", null)
  .option("-i, --idle-timeout <ITIMEOUT>", "server exits after ITIMEOUT when no data transfered", null)
  .parse(process.argv);

try {
  if (Commander.daemon) {
    var Daemon = require("daemonize2").setup({
      main:    "../lib/main.js",
      name:    "strait",
      pidfile: "/var/run/strait/" + source_arg + ".pid",
    });

    Daemon.start();
  } else {
    var main = require("../lib/main");
  }
} catch(e) {
  console.log(e);
  Commander.help();
  process.exit(2);
}
